# Simple social network

## О чем проект

Проект представляет собой **backend** для социальной сети наподобие твиттера.
Пользователи могут создавать посты, смотреть посты других пользователей.

## Стек технологий

- Spring Web
- Spring Data Jpa
- Spring Security
- Spring Validation
- Spring Mail
- Spring Boot
- Postgresql
- Gradle
- Docker

## Конфигурация

Для корректной работы приложения необходимо правильно его настроить в файле `application.properties`.
Для настройки **Spring Mail** используются следующие параметры:

- `spring.mail.host`
- `spring.mail.port`
- `spring.mail.username`
- `spring.mail.password`
- `spring.mail.properties.mail.smtp.starttls.enable`

Также в проекте есть бин `EmailService`, который нуждается в настройке.
Его параметры:

- `email-service.admin-email` - Email администратора приложения для получения запросов на подтверждение роли админа.
  **Обязательно для указания**.


- `email-service.domain` - Домен текущего сервера. **Можно не указывать**.
  По умолчанию равняется `localhost`.


- `email-service.port` - Порт текущего сервера. **Можно не указывать**.


- `email-service.use-https` - Булево значение, отвечает за использование протокола **https**.
  **Можно не указывать**. По умолчанию равняется **false**. При указании значения **true**,
  потребуется указать параметр `email-service.domain`.

**В целях тестирования можно оставить значения по умолчанию.**

## Запуск

Запустить приложение можно командой `docker-compose up`, сконфигурировав перед этим его под себя.

## Эндпойнты

Эндпойнты разбиты по трем категориям:

1. **auth** - Для регистрации, авторизации и прочих операций, связанных с безопасностью.
2. **user** - Для операций, связанных с пользователями.
3. **pub** - Для операций, связанных с публикациями.

## Примеры всех возможных эндпойнтов

---

- [POST] `/auth/register` - регистрация нового пользователя.

В тело подается **json** вида:

```json
{
  "username": "user",
  "password": "passwd",
  "email": "user@gmail.com",
  "is_admin": false
}
```

Если параметр `is_admin` равен **true**, создается неактивный пользователь с ролью `ADMIN_DISABLED`
и на почту, указанную в параметре `email-service.admin-email` кофигурационного файла, отправляется
письмо со ссылкой на подтверждение. После перехода по ссылке, пользователь получает роль `ADMIN_ENABLED`
и становится активным.

---

- [POST] `/auth/login` - вход в аккаунт.

В тело подается **json** вида:

```json
{
  "username": "user",
  "password": "passwd"
}
```

---

- [POST] `/auth/logout` - выход из аккаунта.

---

- [GET] `/auth/enable/{token}` - активировать аккаунт админа.

Ссылка, приходящая на почту указанную в параметре `email-service.admin-email` кофигурационного файла,
отправляет запрос на этот эндпойнт.

---

- [POST] `/auth/send_again/{userId}` - Послать еще одно письмо о подтверждении, так как ссылка действительна
  только в течении часа.

---

- [POST] `/user/edit/{userId}` - редактировать профиль пользователя.

В тело подается **json** вида:

```json
{
  "username": "user",
  "password": "passwd",
  "email": "user@gmail.com",
  "is_admin": false
}
```

Пользователи с ролью `USER` могут редактировать лишь свой профиль, в то время как
пользователи с ролью `ADMIN_ENABLED` могут редактировать профиль любого пользователя.

---

- [GET] `/user/get/{userId}` - получить данные профиля пользователя.

Пользователи с ролью `USER` могут получить данные лишь своего профиля, в то время как
пользователи с ролью `ADMIN_ENABLED` могут получить данные профиля любого пользователя.

---

- [GET] `/user/get/all` - получить данные профилей всех пользователей.

Эндпойнт работает только для пользователей с ролью `ADMIN_ENABLED`.

---

- [POST] `/pub/add` - создать новый пост.

В тело подается **json** вида:

```json
{
  "text": "Here is my first publication!"
}
```

---

- [POST] `/pub/edit/{publicationId}` - редактировать пост.

Пользователи с ролью `USER` могут редактировать лишь свой пост, в то время как
пользователи с ролью `ADMIN_ENABLED` могут редактировать пост любого пользователя.

В тело подается **json** вида:

```json
{
  "text": "Here is my first publication!"
}
```

---

- [DELETE] `/pub/remove/{publicationId}` - удалить пост.

Пользователи с ролью `USER` могут удалить лишь свой пост, в то время как
пользователи с ролью `ADMIN_ENABLED` могут удалить пост любого пользователя.

---

- [GET] `/pub/get/{userId}` - получить данные всех постов пользователя.

---

- [GET] `/pub/get/all` - получить данные всех существующих постов.

## PS

В проекте содержится бин `UserInitializer`, который по умолчанию создает двух
пользователей с ролями `USER` и `ADMIN_ENABLED` для удобства в тестировании.
Данные для входа:

---

- **admin**

```json
{
  "username": "admin",
  "password": "admin"
}
```

---

- **user**

```json
{
  "username": "user",
  "password": "user"
}
```

---